var _ezoop = window.ezoop, ezoop = function() {};

ezoop.noConflict = function() {
    return window.ezoop = _ezoop, this;
}, window.ezoop = ezoop, ezoop.ExtendedClass = function(t, i) {
    return ezoop.Class(t, i);
}, ezoop.BaseClass = function(t) {
    return ezoop.Class(null, t);
}, ezoop.Class = function(t, i) {
    var e = null, n = ezoop.Class;
    return null == t || "undefined" == typeof t ? (e = function() {
        "undefined" != typeof this.initialize && this.initialize.apply(this, arguments);
    }, e.prototype = i) : (e = function() {
        if ("undefined" != typeof t.prototype) {
            var i = t.prototype.initialize;
            "function" == typeof i && i.apply(this, arguments);
        }
        var e = "function" == typeof this.initialize ? this.initialize : "undefined";
        "function" == typeof e && e.apply(this, arguments);
    }, n.inheritPrototype(e, t), n.augmentPrototype(e.prototype, i)), e;
}, ezoop.Class.inheritPrototype = function(t, i) {
    var e = function() {};
    e.prototype = i.prototype, t.prototype = new e(), t.prototype.constructor = t, t.parent = i.prototype;
}, ezoop.Class.augmentPrototype = function(t, i) {
    if (t = t || {}, i) {
        for (var e in i) {
            var n = i[e];
            void 0 !== n && (t[e] = n);
        }
        var o = "function" == typeof window.Event && i instanceof window.Event;
        !o && i.hasOwnProperty && i.hasOwnProperty("toString") && (t.toString = i.toString);
    }
};

var oldGeoDash = window.GeoDash, GeoDash = function() {};

GeoDash.version = "0.1-dev", GeoDash.noConflict = function() {
    return window.GeoDash = oldGeoDash, this;
}, window.GeoDash = GeoDash, GeoDash.Chart = ezoop.BaseClass({
    className: "Chart",
    defaults: {},
    initialize: function(t, i) {
        this.el = t, this.options = {}, this.setOptions(i), this.makeTitle(), this.setUpChart(), 
        this.drawChart();
    },
    setOptions: function(t) {
        for (var i in this.defaults) this.defaults.hasOwnProperty(i) && void 0 === t[i] && (t[i] = this.defaults[i]);
        this.options = t;
    },
    setUpChart: function() {
        d3.select(this.el).style("position", "relative");
    },
    drawChart: function() {
        var t = this;
        this.margin = {
            top: 10,
            right: 10,
            bottom: 10,
            left: 10
        }, this.setWidth(), this.setHeight(), this.formatPercent = d3.format(".0%"), this.formatLarge = d3.format("s"), 
        this.formatComma = d3.format(",");
        var i = this.width;
        this.options.yLabel && (i -= this.options.axisLabelPadding), this.options.drawY && (i -= this.options.yaxisLabelPadding), 
        this.xrange = i, this.x = d3.scale.ordinal().rangeRoundBands([ 0, i ], .05, t.options.outerPadding);
        var e = this.height;
        this.options.xLabel && (e -= this.options.axisLabelPadding), this.options.drawX && (e -= this.options.axisLabelPadding), 
        this.yrange = e, this.y = d3.scale.linear().range([ e, 0 ]), this.container = d3.select(this.el).append("div").attr("class", function() {
            return "geodash " + t.options.class;
        }).style("width", this.width + "px").style("height", this.height + "px").style("margin-top", this.margin.top + "px").style("margin-bottom", this.margin.bottom + "px").style("margin-left", t.margin.left + "px").style("margin-right", this.margin.right + "px"), 
        this.xAxisElement = this.container.append("div").attr("class", "x axis").style("margin-left", function() {
            return t.width - t.xrange + "px";
        }).style("width", function() {
            return i + "px";
        }), t.options.xLabel && this.xAxisElement.append("div").attr("class", "xAxisLabel").style("height", this.options.axisLabelPadding + "px").append("div").attr("class", "gd-label").style("line-height", this.options.axisLabelPadding + "px").text(this.options.xLabel), 
        this.yAxisElement = this.container.append("div").attr("class", "y axis"), t.options.yLabel && this.yAxisElement.append("div").attr("class", "yAxisLabel").style("height", this.options.axisLabelPadding + "px").style("width", this.height - this.margin.bottom + "px").style("left", -1 * ((this.height - this.margin.bottom - this.margin.top) / 2) + "px").append("div").attr("class", "gd-label").style("line-height", this.options.axisLabelPadding + "px").text(this.options.yLabel), 
        this.container.append("div").attr("class", "bars").style("height", function() {
            return e + "px";
        }).style("width", function() {
            return i + "px";
        }).style("margin-left", function() {
            return t.width - t.xrange + "px";
        }), "LineChart" === t.className && (this.svg = this.container.select(".bars").append("svg")), 
        this.container.append("div").attr("class", "hoverbox");
    },
    updateChart: function() {},
    updateYAxis: function() {
        var t = this;
        if (this.options.drawY) {
            var i = this.y.ticks(), e = this.yAxisElement.selectAll(".tick").data(i), i = e.transition().style("top", function(i) {
                return t.y(i) + "px";
            });
            i.select(".gd-label").text(function(i) {
                var e = t.formatLarge(i);
                return t.options.money && (e = "$" + e), t.options.percent && (e += "%"), e;
            });
            var n = e.enter().append("div").attr("class", "tick").style("top", function(i) {
                return t.y(i) + "px";
            }).style("left", function() {
                return t.options.yLabel ? t.options.axisLabelPadding + "px" : void 0;
            }).style("width", function() {
                return t.options.yLabel ? t.width - t.options.axisLabelPadding + "px" : t.width + "px";
            });
            e.exit().remove(), n.append("div").attr("class", "line").style("width", "100%"), 
            n.append("div").attr("class", "gd-label").text(function(i) {
                var e = t.formatLarge(i);
                return t.options.money && (e = "$" + e), t.options.percent && (e += "%"), e;
            }).style("margin-top", function() {
                var t = d3.select(this).style("height"), i = -1 * (parseInt(t) / 2);
                return i + "px";
            }).style("width", t.options.yaxisLabelPadding + "px");
        }
    },
    updateXAxis: function() {
        var t = this;
        if (this.options.drawX) {
            var i = this.x.domain(), e = this.xAxisElement.selectAll(".tick").data(i), n = e.transition().style("left", function(i) {
                return t.x(i) + "px";
            }).style("width", t.x.rangeBand() + "px");
            n.select(".line").style("margin-left", function() {
                var i = t.x.rangeBand() / 2;
                return i + "px";
            }), n.select(".gd-label").text(function(i) {
                return t.options.xFormat ? t.options.xFormat(i) : i;
            });
            var o = e.enter().append("div").attr("class", "tick").style("left", function(i) {
                return t.x(i) + "px";
            }).style("width", t.x.rangeBand() + "px").style("bottom", function() {
                var i = t.height - t.yrange - t.options.axisLabelPadding;
                return i + "px";
            }).style("height", t.options.axisLabelPadding + "px");
            e.exit().remove(), o.append("div").attr("class", "line").style("margin-left", function() {
                var i = t.x.rangeBand() / 2;
                return i + "px";
            }), o.append("div").attr("class", "gd-label").text(function(i) {
                return t.options.xFormat ? t.options.xFormat(i) : i;
            });
        }
    },
    update: function() {},
    makeTitle: function() {
        if (this.options.title) {
            var t = '<div class="geodash-title">' + this.options.title + "</div>";
            d3.select(this.el).html(t);
        }
    },
    getData: function() {
        return this.data;
    },
    setWidth: function() {
        this.width = parseInt(d3.select(this.el).style("width")), this.width = this.width - this.margin.left - this.margin.right;
    },
    setHeight: function() {
        this.height = parseInt(d3.select(this.el).style("height")), this.height = this.height - this.margin.top - this.margin.bottom, 
        this.options.title && (this.height = this.height - 30);
    },
    setYAxisLabel: function(t) {
        this.container.select(".y.axis .yAxisLabel .gd-label").text(t);
    },
    setXAxisLabel: function(t) {
        this.container.select(".y.axis .xAxisLabel .gd-label").text(t);
    }
}), GeoDash.TableChart = ezoop.ExtendedClass(GeoDash.Chart, {
    className: "TableChart",
    defaults: {
        highlight: [],
        format: !1
    },
    initialize: function() {},
    drawChart: function() {
        this.margin = {
            top: 20,
            right: 10,
            bottom: 20,
            left: 40
        }, this.width = ("auto" === this.options.width || void 0 === this.options.width ? parseInt(d3.select(this.el).style("width")) : this.options.width) - this.margin.left - this.margin.right, 
        this.height = ("auto" === this.options.height || void 0 === this.options.height ? parseInt(d3.select(this.el).style("height")) : this.options.height) - this.margin.top - this.margin.bottom, 
        this.options.title && (this.height = this.height - 30), this.formatPercent = d3.format(".2%"), 
        this.formatPercentAxisLabel = d3.format(".0%"), this.formatLarge = d3.format("s"), 
        this.formatComma = d3.format(",.2f"), this.table = d3.select(this.el).append("table").attr("width", this.width + this.margin.left + this.margin.right).attr("class", "table table-condensed table-bordered gd-table"), 
        this.tbody = this.table.append("tbody");
    },
    update: function(t) {
        var i = this, e = this.tbody.selectAll("tr").data(t).attr("style", function(t) {
            for (var e = t[i.options.columns[0]], n = 0; n < i.options.highlight.length; n++) if (i.options.highlight[n] == e) return "background:" + i.options.color;
            return "";
        });
        e.enter().append("tr").attr("style", function(t) {
            for (var e = t[i.options.columns[0]], n = 0; n < i.options.highlight.length; n++) if (i.options.highlight[n] == e) return "background:" + i.options.color;
            return "";
        }), e.exit().remove();
        var n = e.selectAll("td").data(function(t) {
            return i.options.columns.map(function(i) {
                return {
                    column: i,
                    value: t[i]
                };
            });
        });
        return n.transition().text(function(t) {
            return i.format(t);
        }), n.enter().append("td").text(function(t) {
            return i.format(t);
        }), n.exit().remove(), this;
    },
    format: function(t) {
        var i = "", e = this;
        if (null === t.value) return i = "NA";
        if (isNaN(parseFloat(t.value))) i = t.value; else {
            if (e.options.format) {
                var n = d3.format(",." + e.options.format.precision + "f");
                i = n(t.value);
            } else i = e.formatComma(t.value);
            e.options.money && (i = "$" + i), e.options.percent && (i += "%");
        }
        return i;
    }
}), GeoDash.LineChart = ezoop.ExtendedClass(GeoDash.Chart, {
    className: "LineChart",
    defaults: {
        x: "x",
        y: "y",
        width: "auto",
        height: "auto",
        colors: [ "#d80000", "#006200" ],
        interpolate: "monotone",
        dotRadius: 3,
        title: !1,
        opacity: .5,
        strokeWidth: 2,
        drawX: !0,
        drawY: !0,
        xLabel: !1,
        yLabel: !1,
        xInterval: "auto",
        dashed: !1,
        time: !0,
        axisLabelPadding: 20,
        yaxisLabelPadding: 25,
        "class": "chart-html linechart vertical",
        xFormat: d3.time.format("%Y-%m-%d"),
        outerPadding: 0
    },
    initialize: function() {},
    update: function(t) {
        var i = this;
        this.data = t, this.color = d3.scale.ordinal().range(this.options.colors), this.color.domain(d3.keys(t[0]).filter(function(t) {
            return t !== i.options.x;
        })), this.linedata = this.color.domain().map(function(e) {
            return {
                name: e,
                values: t.map(function(t) {
                    var n, o = t[i.options.x];
                    return n = null === t[e] ? null : +t[e], {
                        date: o,
                        value: n
                    };
                })
            };
        });
        for (var e = 0; e < this.linedata.length; e++) {
            for (var n = [], o = 0; o < this.linedata[e].values.length; o++) {
                var s = this.linedata[e].values[o].value;
                isNaN(s) || null === s || n.push(this.linedata[e].values[o]);
            }
            this.linedata[e].values = n;
        }
        this.xLine = this.options.time ? d3.time.scale().range([ 0, this.xrange ]) : d3.scale.linear().range([ 0, this.xrange ]), 
        this.xLine.domain(d3.extent(this.data, function(t) {
            return t[i.options.x];
        })), "auto" == i.options.xInterval ? this.xLine.ticks(t.length) : this.xLine.ticks(i.options.xInterval), 
        this.x.domain(this.xLine.ticks()), this.y.domain([ d3.min(this.linedata, function(t) {
            return d3.min(t.values, function(t) {
                return t.value;
            });
        }), d3.max(this.linedata, function(t) {
            return d3.max(t.values, function(t) {
                return t.value;
            });
        }) ]);
        var a = this.y.domain();
        this.y.domain([ a[0] - .1 * a[0], a[1] + .1 * a[1] ]), this.updateChart(), this.updateXAxis(), 
        this.updateYAxis();
    },
    updateChart: function() {
        var t = this;
        this.line = d3.svg.line().interpolate(this.options.interpolate).x(function(i) {
            return t.x(i.date) + t.x.rangeBand() / 2;
        }).y(function(i) {
            return t.y(i.value);
        });
        var i = function(t, i) {
            return 10 * i;
        }, e = this.svg.selectAll(".line_group").data(this.linedata), n = this.svg.selectAll(".line").data(this.linedata);
        n.transition().style("stroke", function(i) {
            return t.color(i.name);
        }).style("stroke-dasharray", function(t) {
            return t.dashed ? "5, 5" : "none";
        }).attr("d", function(i) {
            return t.line(i.values);
        }), n.enter().append("g").attr("class", function(t, i) {
            return "line_group line_group" + i;
        }).append("path").attr("class", "line").attr("d", function(i) {
            return t.line(i.values);
        }).style("stroke", function(i) {
            return t.color(i.name);
        }).style("stroke-width", t.options.strokeWidth).style("stroke-dasharray", function(t) {
            return t.dashed ? "5, 5" : "none";
        }).style("stroke-opacity", t.options.opacity), n.exit().selectAll(".dot"), n.exit().remove(), 
        e.exit().remove();
        for (var o = 0; o < this.linedata.length; o++) {
            var s = this.linedata[o].values, a = this.svg.select(".line_group" + o).selectAll(".dot").data(s);
            a.transition().duration(500).delay(i).attr("data", function(t) {
                return t.value;
            }).style("fill", function() {
                return t.color(t.linedata[o].name);
            }).attr("cx", function(i) {
                return t.x(i.date) + t.x.rangeBand() / 2;
            }).attr("cy", function(i) {
                return t.y(i.value);
            }), a.enter().append("circle").attr("class", "dot").attr("r", this.options.dotRadius).style("fill", function() {
                return t.color(t.linedata[o].name);
            }).style("fill-opacity", t.options.opacity).attr("data", function(t) {
                return t.value;
            }).on("mouseover", function(i, e) {
                t.mouseOver(i, e, this);
            }).on("mouseout", function(i, e) {
                t.mouseOut(i, e, this);
            }).attr("cx", function(i) {
                return t.x(i.date) + t.x.rangeBand() / 2;
            }).attr("cy", function(i) {
                return t.y(i.value);
            }), a.exit().remove();
        }
    },
    mouseOver: function(t, i, e) {
        var n = this;
        d3.select(e).transition().attr("r", this.options.dotRadius + 3);
        var o = "";
        o = n.options.xFormat ? n.options.xFormat(t.date) : t.date, o += ": ", o += n.options.percent ? n.formatPercent(t.value) : n.formatComma(t.value), 
        n.container.select(".hoverbox").html(o), n.container.select(".hoverbox").transition().style("display", "block");
    },
    mouseOut: function(t, i, e) {
        var n = this;
        d3.select(e).transition().attr("r", this.options.dotRadius), n.container.select(".hoverbox").transition().style("display", "none");
    }
}), GeoDash.PieChart = ezoop.ExtendedClass(GeoDash.Chart, {
    className: "PieChart",
    defaults: {
        label: "label",
        value: "value",
        colors: [ "#f00", "#0f0", "#00f" ],
        innerRadius: 10,
        opacity: 1,
        drawX: !1,
        drawY: !1,
        title: !1,
        padding: 10,
        legend: !1,
        hover: !1,
        arclabels: !1
    },
    initialize: function() {},
    setColors: function(t) {
        this.color = d3.scale.ordinal().range(t);
    },
    drawChart: function() {
        var t = this;
        this.width = "auto" === this.options.width || void 0 === this.options.width ? parseInt(d3.select(this.el).style("width")) : this.options.width, 
        this.height = "auto" === this.options.height || void 0 === this.options.width ? parseInt(d3.select(this.el).style("height")) : this.options.height, 
        this.width = this.width - 2 * this.options.padding, this.height = this.height - 2 * this.options.padding, 
        this.options.title && (this.height = this.height - 30), this.radius = Math.min(this.width, this.height) / 2.2, 
        this.color = d3.scale.ordinal().range(this.options.colors), this.x = d3.scale.ordinal().range([ 0, this.width - 2 ]), 
        this.y = d3.scale.linear().range([ this.height - 2, 0 ]), this.xAxis = d3.svg.axis().scale(this.x).orient("bottom").tickSize(10, 0, 0).tickFormat(function() {
            return "";
        }), this.yAxis = d3.svg.axis().scale(this.y).orient("left").tickSize(10, 0, 0).tickFormat(function() {
            return "";
        }), this.arc = d3.svg.arc().outerRadius(this.radius).innerRadius(this.options.innerRadius), 
        this.pie = d3.layout.pie().sort(null).value(function(i) {
            return i[t.options.value];
        }), this.formatHover = d3.format(",.0f"), this.formatPercent = d3.format(".2f"), 
        this.svg = d3.select(this.el).append("svg").attr("width", this.width).attr("height", this.height).attr("class", "piechart-svg").append("g").attr("transform", "translate(" + this.width / 2 + "," + this.height / 2 + ")"), 
        this.options.hover && d3.select(this.el).append("div").attr("class", "hoverbox"), 
        this.options.drawX && (this.svg.append("g").attr("class", "x axis").attr("transform", "translate(" + -1 * (this.width / 2) + "," + 0 + ")").call(this.xAxis), 
        this.svg.select(".x.axis").selectAll(".tick").attr("transform", "translate(0,-5)")), 
        this.options.drawY && (this.svg.append("g").attr("class", "y axis").attr("transform", "translate(0," + -1 * (this.height / 2) + ")").call(this.yAxis), 
        this.svg.select(".y.axis").selectAll(".tick").attr("transform", "translate(5,0)")), 
        this.options.legend && d3.select(this.options.legend).append("svg");
    },
    update: function(t) {
        var i = this;
        i.total = 0, t.forEach(function(t) {
            t[i.options.value] = +t[i.options.value], i.total += +t[i.options.value];
        }), this.x.domain([ 0, 1 ]), this.y.domain([ 0, 1 ]), this.xAxis.tickValues([ 0, 1 ]), 
        this.yAxis.tickValues([ 0, 1 ]), this.options.drawX && svg.select(".x.axis").transition().call(this.xAxis), 
        this.options.drawY && svg.select(".y.axis").transition().call(this.yAxis);
        var e = this.svg.selectAll(".arc").data(this.pie(t));
        if (e.select("path").transition().style("fill", function(t) {
            return i.color(t.data[i.options.label]);
        }).attr("d", this.arc), e.enter().append("g").attr("class", "arc").append("path").attr("d", this.arc).style("fill", function(t) {
            return i.color(t.data[i.options.label]);
        }).style("fill-opacity", this.options.opacity).on("mouseover", function(t) {
            if (d3.select(this).style("fill-opacity", 1), i.options.hover) {
                var e = t.data[i.options.label], n = i.formatHover(t.value), o = i.formatPercent(100 * (t.value / i.total));
                d3.select(i.el).select(".hoverbox").html(e + ": " + n + " (" + o + "%)"), d3.select(i.el).select(".hoverbox").style("display", "block");
            }
        }).on("mouseout", function() {
            d3.select(i.el).select(".hoverbox").html(""), d3.select(i.el).select(".hoverbox").style("display", "none"), 
            d3.select(this).style("fill-opacity", i.options.opacity);
        }), e.exit().remove(), this.options.arclabels) {
            var n = i.svg.selectAll(".arc-text").data(this.pie(t));
            n.select("text").attr("transform", function(t) {
                return "translate(" + i.arc.centroid(t) + ")";
            }).text(function(t) {
                return t.data[i.options.label] + " (" + t.value + ")";
            }), n.enter().append("g").attr("class", "arc-text").append("text").attr("transform", function(t) {
                return "translate(" + i.arc.centroid(t) + ")";
            }).attr("dy", ".35em").style("text-anchor", "middle").text(function(t) {
                return t.data[i.options.label] + " (" + t.value + ")";
            }), n.exit().remove();
        }
        if (this.options.legend) {
            parseInt(d3.select(this.options.legend).style("width"));
            var o = {
                width: 10,
                height: 10,
                padding: 5
            }, s = d3.select(this.options.legend).select("svg"), a = s.selectAll(".legend-item").data(this.color.domain().slice());
            a.select(".legend-item").select("text").text(function(t) {
                return t;
            });
            var r = a.enter().append("g").attr("class", "legend-item").attr("transform", function(t, i) {
                return "translate(0," + i * (o.height + o.padding) + ")";
            });
            r.append("rect").attr("x", 0).attr("width", o.width).attr("height", o.height).style("fill", this.color), 
            r.append("text").attr("x", o.width + o.padding).attr("y", 4).attr("dy", ".35em").style("text-anchor", "start").text(function(t) {
                return t;
            });
        }
    }
}), GeoDash.BarChartHorizontal = ezoop.ExtendedClass(GeoDash.Chart, {
    className: "BarChartHorizontal",
    defaults: {
        x: "x",
        y: "y",
        barColors: [ "#f00" ],
        opacity: .7,
        drawX: !1,
        drawY: !1,
        percent: !1,
        money: !1,
        title: !1,
        roundRadius: 3,
        highlight: [],
        verticalX: !1,
        invert: !1,
        barHeight: 0,
        padding: 2,
        topPadding: 15,
        numberTicks: 10,
        yWidth: 0,
        round: !0,
        format: !1,
        axisLabelPadding: 20,
        rightBarPadding: 10,
        outerPadding: .5
    },
    initialize: function() {},
    drawChart: function() {
        var t = this;
        this.margin = {
            top: 10,
            right: 10,
            bottom: 10,
            left: 10
        }, 0 !== this.options.barHeight && d3.select(this.el).style("height", "auto"), this.setWidth(), 
        this.setHeight(), this.formatPercent = d3.format(".2%"), this.formatPercentAxisLabel = d3.format("p"), 
        this.formatMoney = d3.format("$"), this.formatLarge = d3.format("s"), this.formatComma = d3.format(",");
        var i = this.width;
        this.options.drawY && (i -= this.options.yWidth), this.options.yLabel && (i -= this.options.axisLabelPadding), 
        this.xrange = i, this.x = d3.scale.linear().range([ 0, i - t.options.rightBarPadding ]).nice();
        var e = this.height;
        this.options.drawX && (e -= this.options.axisLabelPadding), this.options.xLabel && (e -= this.options.axisLabelPadding), 
        this.yrange = e, this.y = d3.scale.ordinal().rangeRoundBands([ e, 0 ], .05, .3), 
        this.container = d3.select(this.el).append("div").attr("class", "geodash chart-html horizontal").style("width", this.width + "px").style("height", this.height + "px").style("margin-top", this.margin.top + "px").style("margin-bottom", this.margin.bottom + "px").style("margin-right", this.margin.right + "px").style("margin-left", this.margin.left + "px"), 
        this.options.drawX && (this.xAxisElement = this.container.append("div").attr("class", "x axis").style("margin-left", function() {
            return t.width - t.xrange + "px";
        }).style("width", function() {
            return i + "px";
        }), t.options.xLabel && this.xAxisElement.append("div").attr("class", "xAxisLabel").style("height", this.options.axisLabelPadding + "px").append("div").attr("class", "gd-label").style("line-height", this.options.axisLabelPadding + "px").text(this.options.xLabel)), 
        this.options.drawY && (this.yAxisElement = this.container.append("div").attr("class", "y axis").style("height", function() {
            return e + "px";
        }), t.options.yLabel && this.yAxisElement.append("div").attr("class", "yAxisLabel").style("height", this.options.axisLabelPadding + "px").style("width", this.height - this.margin.bottom + "px").style("left", -1 * ((this.height - this.margin.bottom - this.margin.top) / 2) + "px").append("div").attr("class", "gd-label").style("line-height", this.options.axisLabelPadding + "px").text(this.options.yLabel)), 
        this.container.append("div").attr("class", "bars").style("height", function() {
            return e + "px";
        }).style("width", function() {
            return i + "px";
        }).style("margin-left", function() {
            return t.width - t.xrange + "px";
        }), this.container.append("div").attr("class", "hoverbox");
    },
    update: function(t) {
        var i = this;
        this.data = t;
        for (var e = this.options.y, n = this.options.x, o = 0; o < t.length; o++) {
            var s = t[o];
            null != s[n] && "string" == typeof s[n] && (s[n] = +s[n].replace(",", ""));
        }
        if (0 !== this.options.barHeight) {
            var a = this.options.barHeight * t.length + this.options.padding * t.length + this.options.topPadding;
            d3.select(this.el).select(".bars").style("height", a + "px");
        }
        this.color = d3.scale.ordinal().range(this.options.barColors);
        var r = d3.extent(t, function(t) {
            return t[n];
        });
        r[0] < 0 ? this.x.domain(r) : this.x.domain([ 0, r[1] ]), this.y.domain(t.map(function(t) {
            return t[e];
        }));
        var l = this.container.select(".bars").selectAll(".bar").data(t);
        l.transition().attr("geodash-id", function(t) {
            return t[e];
        }).style("left", function(t) {
            var e = i.x(Math.min(0, t[n]));
            return e === i.x(0) && (e += 1), e + "px";
        }).style("top", function(t, n) {
            var o = 0;
            return o = 0 !== i.options.barHeight ? i.options.barHeight * n + i.options.padding * n + i.options.topPadding : i.y(t[e]), 
            o + "px";
        }).style("width", function(t) {
            var e = Math.abs(i.x(t[n]) - i.x(0));
            return e + "px";
        }).style("height", function() {
            return 0 !== i.options.barHeight ? i.options.barHeight + "px" : i.y.rangeBand() + "px";
        }).style("opacity", function(t) {
            for (var n = 0; n < i.options.highlight.length; n++) if (i.options.highlight[n] == t[e]) return 1;
            return i.options.opacity;
        }).style("border-top-right-radius", function(t) {
            var e = 0, o = i.x(Math.min(0, t[n]));
            return o >= i.x(0) && (e = i.options.roundRadius), e + "px";
        }).style("border-bottom-right-radius", function(t) {
            var e = 0, o = i.x(Math.min(0, t[n]));
            return o >= i.x(0) && (e = i.options.roundRadius), e + "px";
        }).style("border-top-left-radius", function(t) {
            var e = 0, o = i.x(Math.min(0, t[n]));
            return o < i.x(0) && (e = i.options.roundRadius), e + "px";
        }).style("border-bottom-left-radius", function(t) {
            var e = 0, o = i.x(Math.min(0, t[n]));
            return o < i.x(0) && (e = i.options.roundRadius), e + "px";
        }).style("background-color", function(t) {
            return i.color(t[e]);
        }, "important");
        var h = l.enter().append("div").attr("class", "bar").attr("geodash-id", function(t) {
            return t[e];
        }).style("left", function(t) {
            var e = i.x(Math.min(0, t[n]));
            return e === i.x(0) && (e += 1), e + "px";
        }).style("top", function(t, n) {
            var o = 0;
            return o = 0 !== i.options.barHeight ? i.options.barHeight * n + i.options.padding * n + i.options.topPadding : i.y(t[e]), 
            o + "px";
        }).style("width", function(t) {
            var e = Math.abs(i.x(t[n]) - i.x(0));
            return e + "px";
        }).style("height", function() {
            return 0 !== i.options.barHeight ? i.options.barHeight + "px" : i.y.rangeBand() + "px";
        }).style("opacity", function(t) {
            for (var n = 0; n < i.options.highlight.length; n++) if (i.options.highlight[n] == t[e]) return 1;
            return i.options.opacity;
        }).style("border-top-right-radius", function(t) {
            var e = 0, o = i.x(Math.min(0, t[n]));
            return o >= i.x(0) && (e = i.options.roundRadius), e + "px";
        }).style("border-bottom-right-radius", function(t) {
            var e = 0, o = i.x(Math.min(0, t[n]));
            return o >= i.x(0) && (e = i.options.roundRadius), e + "px";
        }).style("border-top-left-radius", function(t) {
            var e = 0, o = i.x(Math.min(0, t[n]));
            return o < i.x(0) && (e = i.options.roundRadius), e + "px";
        }).style("border-bottom-left-radius", function(t) {
            var e = 0, o = i.x(Math.min(0, t[n]));
            return o < i.x(0) && (e = i.options.roundRadius), e + "px";
        }).style("-webkit-print-color-adjust", "exact").style("background-color", function(t) {
            return i.color(t[e]);
        }, "important");
        if (l.exit().remove(), h.on("mouseover", function(t, e) {
            i.barmouseover(t, e);
        }).on("mouseout", function(t, e) {
            i.barmouseout(t, e);
        }), this.options.drawX) {
            var d = this.x.ticks(i.options.numberTicks), p = this.xAxisElement.selectAll(".tick").data(d), d = p.transition().style("left", function(t) {
                var e = i.x(t);
                return e + "px";
            });
            d.select(".gd-label").text(function(t) {
                var e = i.formatLarge(t);
                return i.options.money && (e = "$" + e), i.options.percent && (e += "%"), e;
            });
            var u = p.enter().append("div").attr("class", "tick").style("left", function(t) {
                var e = i.x(t);
                return e + "px";
            }).style("bottom", function() {
                return i.options.yLabel ? i.options.axisLabelPadding + "px" : void 0;
            }).style("height", function() {
                return i.options.xLabel ? i.height - i.options.axisLabelPadding + "px" : i.height + "px";
            });
            p.exit().remove(), u.append("div").attr("class", "line").style("height", "100%"), 
            u.append("div").attr("class", "gd-label").text(function(t) {
                var e = i.formatLarge(t);
                return i.options.money && (e = "$" + e), i.options.percent && (e += "%"), e;
            }).style("bottom", "0px").style("background", function() {
                var t = d3.select(i.el).style("background-color");
                return t;
            }).style("margin-left", function() {
                var t = d3.select(this).style("width"), i = -1 * (parseInt(t) / 2);
                return i + "px";
            }).style("height", i.options.axisLabelPadding + "px").style("line-height", i.options.axisLabelPadding + "px");
        }
        if (this.options.drawY) {
            var c = parseInt(d3.select(i.el).select(".bars").style("width"));
            isNaN(c) || (barWidth = c);
            var g = this.y.domain(), p = this.yAxisElement.selectAll(".tick").data(g), d = p.transition().style("top", function(t, e) {
                var n = 0;
                return n = 0 !== i.options.barHeight ? i.options.barHeight * e + i.options.padding * e + i.options.topPadding : i.y(t), 
                n + "px";
            }).style("right", function() {
                return "0px";
            }).style("padding-right", function(t, e) {
                var o = i.data[e][n], s = i.x(Math.min(0, o)), a = barWidth - s + 2;
                return a + "px";
            }).style("height", function() {
                return 0 !== i.options.barHeight ? i.options.barHeight + "px" : i.y.rangeBand() + "px";
            }).style("line-height", function() {
                return 0 !== i.options.barHeight ? i.options.barHeight + "px" : i.y.rangeBand() + "px";
            }).select(".gd-label").text(function(t) {
                return t;
            }), u = p.enter().append("div").attr("class", "tick").style("top", function(t, e) {
                var n = 0;
                return n = 0 !== i.options.barHeight ? i.options.barHeight * e + i.options.padding * e + i.options.topPadding : i.y(t), 
                n + "px";
            }).style("right", function() {
                return "0px";
            }).style("padding-right", function(t, e) {
                var o = i.data[e][n], s = i.x(Math.min(0, o)), a = barWidth - s + 2;
                return a + "px";
            }).style("height", function() {
                return 0 !== i.options.barHeight ? i.options.barHeight + "px" : i.y.rangeBand() + "px";
            }).style("line-height", function() {
                return 0 !== i.options.barHeight ? i.options.barHeight + "px" : i.y.rangeBand() + "px";
            }).on("mouseover", function(t, e) {
                i.barmouseover(t, e);
            }).on("mouseout", function(t, e) {
                i.barmouseout(t, e);
            }).append("div").attr("class", "gd-label").text(function(t) {
                return t;
            });
            p.exit().remove();
        }
    },
    barmouseover: function(t, i) {
        var e = this, n = "";
        n = "object" == typeof t ? t[e.options.y] : t;
        var o = e.data[i][e.options.x], s = d3.select(e.el).selectAll(".bar")[0][i];
        d3.select(s).style("opacity", .9);
        var a = "";
        if (null !== o) {
            if (e.options.format) {
                var r = d3.format(",." + e.options.format.precision + "f");
                a = r(o);
            } else a = e.formatComma(o);
            e.options.money && (a = "$" + a), e.options.percent && (a += "%");
        } else a = "NA";
        d3.select(e.el).select(".hoverbox").html(n + ": " + a), d3.select(e.el).select(".hoverbox").transition().style("display", "block");
    },
    barmouseout: function(t, i) {
        for (var e = this, n = e.options.opacity, o = 0; o < e.options.highlight.length; o++) e.options.highlight[o] == t && (n = 1);
        var s = d3.select(e.el).selectAll(".bar")[0][i];
        d3.select(s).style("opacity", n), d3.select(e.el).select(".hoverbox").transition().style("display", "none");
    },
    setColor: function(t) {
        this.options.barColors = t;
    }
}), GeoDash.BarChartVertical = ezoop.ExtendedClass(GeoDash.Chart, {
    className: "BarChartVertical",
    defaults: {
        x: "x",
        y: "y",
        barColors: [ "#f00" ],
        opacity: .7,
        drawX: !1,
        drawY: !1,
        xLabel: !1,
        yLabel: !1,
        percent: !1,
        title: !1,
        roundRadius: 3,
        highlight: !1,
        verticalX: !1,
        invert: !1,
        roundRadius: 3,
        axisLabelPadding: 20,
        yaxisLabelPadding: 25,
        "class": "chart-html vertical",
        outerPadding: .5
    },
    initialize: function() {},
    cleanData: function(t) {
        var i = this.options.y;
        this.options.x;
        for (var e = 0; e < t.length; e++) {
            var n = t[e];
            null != n[i] && "string" == typeof n[i] && (n[i] = +n[i].replace(",", ""));
        }
        return t;
    },
    update: function(t) {
        var i = this.options.y, e = this.options.x;
        this.data = t = this.cleanData(t), this.color = d3.scale.ordinal().range(this.options.barColors), 
        this.x.domain(t.map(function(t) {
            return t[e];
        }));
        var n = d3.extent(t, function(t) {
            return t[i];
        });
        n[0] < 0 ? this.y.domain(n) : this.y.domain([ 0, n[1] ]), this.updateChart(), this.updateXAxis(), 
        this.updateYAxis();
    },
    updateChart: function() {
        var t = this, i = this.options.y, e = this.options.x, n = this.container.select(".bars").selectAll(".bar").data(this.data);
        n.transition().attr("geodash-id", function(t) {
            return t[e];
        }).style("left", function(i) {
            return t.x(i[e]) + "px";
        }).style("width", t.x.rangeBand() + "px").style("bottom", function(e) {
            var n = 0;
            return n = e[i] > 0 ? t.yrange - t.y(0) : t.yrange - t.y(e[i]), n + "px";
        }).style("height", function(e) {
            var n = 0;
            return n = e[i] > 0 ? t.y(0) - t.y(e[i]) : t.y(e[i]) - t.y(0), n + "px";
        }).style("opacity", function(i) {
            return i[e] == t.options.highlight ? 1 : t.options.opacity;
        }).style("background-color", function(i) {
            return t.color(i[e]);
        }).style("border-top-right-radius", function(e) {
            return e[i] > 0 ? t.options.roundRadius + "px" : 0;
        }).style("border-top-left-radius", function(e) {
            return e[i] > 0 ? t.options.roundRadius + "px" : 0;
        }).style("border-bottom-right-radius", function(e) {
            return e[i] < 0 ? t.options.roundRadius + "px" : 0;
        }).style("border-bottom-left-radius", function(e) {
            return e[i] < 0 ? t.options.roundRadius + "px" : 0;
        }).style("background-color", function(i) {
            return t.color(i[e]);
        }), n.enter().append("div").attr("class", "bar").attr("geodash-id", function(t) {
            return t[e];
        }).style("left", function(i) {
            return t.x(i[e]) + "px";
        }).style("width", t.x.rangeBand() + "px").style("bottom", function(e) {
            var n = 0;
            return n = e[i] > 0 ? t.yrange - t.y(0) : t.yrange - t.y(e[i]), n + "px";
        }).style("height", function(e) {
            var n = 0;
            return n = e[i] > 0 ? t.y(0) - t.y(e[i]) : t.y(e[i]) - t.y(0), n + "px";
        }).style("opacity", function(i) {
            return i[e] == t.options.highlight ? 1 : t.options.opacity;
        }).style("background-color", function(i) {
            return t.color(i[e]);
        }).style("border-top-right-radius", function(e) {
            return e[i] > 0 ? t.options.roundRadius + "px" : 0;
        }).style("border-top-left-radius", function(e) {
            return e[i] > 0 ? t.options.roundRadius + "px" : 0;
        }).style("border-bottom-right-radius", function(e) {
            return e[i] < 0 ? t.options.roundRadius + "px" : 0;
        }).style("border-bottom-left-radius", function(e) {
            return e[i] < 0 ? t.options.roundRadius + "px" : 0;
        }).on("mouseover", function(i, e) {
            t.mouseOver(i, e, this);
        }).on("mouseout", function(i, e) {
            t.mouseOut(i, e, this);
        }), n.exit().remove();
    },
    mouseOver: function(t, i, e) {
        var n = this;
        d3.select(e).style("opacity", 1);
        var o = "";
        o = n.options.xFormat ? n.options.xFormat(t[n.options.x]) : t[n.options.x], o += ": ", 
        o += n.options.percent ? n.formatPercent(t[n.options.y]) : n.formatComma(t[n.options.y]), 
        n.container.select(".hoverbox").html(o), n.container.select(".hoverbox").transition().style("display", "block");
    },
    mouseOut: function(t, i, e) {
        var n = this, o = n.options.opacity;
        t[n.options.x] == n.options.highlight && (o = 1), d3.select(e).style("opacity", o), 
        n.container.select(".hoverbox").transition().style("display", "none");
    },
    setColor: function(t) {
        this.options.barColors = t;
    }
});